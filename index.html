<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ColdNova Fullscreen Proxy</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      overflow: hidden;
      font-family: sans-serif;
    }
    #proxy-container {
      width: 100%;
      height: 100%;
      overflow: auto;
      box-sizing: border-box;
    }
    #loading {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 1.5rem;
      color: #333;
    }
  </style>
</head>
<body>
  <div id="loading">Loading ColdNova...</div>
  <div id="proxy-container"></div>

  <script>
    const container = document.getElementById('proxy-container');
    const loading = document.getElementById('loading');
    const targetUrl = 'https://coldnova.xyz/';

    // Rewrite relative URLs in the fetched HTML
    function rewriteUrls(doc, baseUrl) {
      const elements = doc.querySelectorAll('[href], [src]');
      elements.forEach(el => {
        if (el.hasAttribute('href')) {
          el.href = new URL(el.getAttribute('href'), baseUrl).href;
        }
        if (el.hasAttribute('src')) {
          el.src = new URL(el.getAttribute('src'), baseUrl).href;
        }
      });

      // Intercept links to stay in the proxy
      doc.querySelectorAll('a').forEach(a => {
        a.addEventListener('click', e => {
          e.preventDefault();
          loadPage(a.href);
        });
      });
    }

    // Remove ad-related elements from the document
    function removeAds(doc) {
      // Remove Google Ads scripts
      doc.querySelectorAll('script[src*="googlesyndication"], script[src*="adsbygoogle"]').forEach(el => el.remove());
      // Remove Google ad containers
      doc.querySelectorAll('ins.adsbygoogle, .ad-container, .ads-container, [id*="ad"], [class*="ad"]').forEach(el => el.remove());
    }

    async function loadPage(url) {
      try {
        loading.style.display = 'block';
        container.innerHTML = '';
        const response = await fetch('https://corsproxy.io/?' + encodeURIComponent(url));
        const htmlText = await response.text();
        const parser = new DOMParser();
        const doc = parser.parseFromString(htmlText, 'text/html');

        removeAds(doc);      // Remove all ads
        rewriteUrls(doc, url);

        // Inject external CSS
        const stylesheets = Array.from(doc.querySelectorAll('link[rel="stylesheet"]'));
        stylesheets.forEach(link => {
          const newLink = document.createElement('link');
          newLink.rel = 'stylesheet';
          newLink.href = link.href;
          document.head.appendChild(newLink);
        });

        // Inject inline styles
        const inlineStyles = Array.from(doc.querySelectorAll('style'));
        inlineStyles.forEach(style => {
          const newStyle = document.createElement('style');
          newStyle.textContent = style.textContent;
          document.head.appendChild(newStyle);
        });

        // Append body content to container
        Array.from(doc.body.children).forEach(child => container.appendChild(child));

      } catch (err) {
        container.innerHTML = `<p style="color:red;">Failed to load page: ${err.message}</p>`;
        console.error(err);
      } finally {
        loading.style.display = 'none';
      }
    }

    // Always load ColdNova on page load
    window.addEventListener('DOMContentLoaded', () => {
      loadPage(targetUrl);
    });
  </script>
</body>
</html>
